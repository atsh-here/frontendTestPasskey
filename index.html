<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Corbado Passkey Demo</title>
  <script src="https://pro-3857098473696981499.frontendapi.cloud.corbado.io/authn.js"></script>
</head>
<body>
  <h1>üîê Corbado Passkey Demo</h1>
  <input type="text" id="username" placeholder="Enter username" />

  <br><br>

  <button onclick="registerPasskey()">Register Passkey</button>
  <button onclick="loginPasskey()">Login with Passkey</button>

  <pre id="output"></pre>

  <script>
    const backendBase = "https://backendapi.cloud.corbado.io"; // Replace if self-hosted

    async function registerPasskey() {
      const username = document.getElementById("username").value;
      if (!username) return alert("Username required");

      const challengeRes = await fetch("http://localhost:5000/register-challenge", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username }),
      });
      const challenge = await challengeRes.json();

      const credential = await Corbado.passkey.register(challenge);

      const registerRes = await fetch("http://localhost:5000/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(credential),
      });

      const result = await registerRes.json();
      document.getElementById("output").textContent = JSON.stringify(result, null, 2);
    }

    async function loginPasskey() {
      const username = document.getElementById("username").value;
      if (!username) return alert("Username required");

      const challengeRes = await fetch("http://localhost:5000/login-challenge", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username }),
      });
      const challenge = await challengeRes.json();

      const assertion = await Corbado.passkey.login(challenge);

      const loginRes = await fetch("http://localhost:5000/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(assertion),
      });

      const result = await loginRes.json();
      document.getElementById("output").textContent = JSON.stringify(result, null, 2);
    }
  </script>
</body>
</html>
